/* Map of GeoJSON data from corn.geojson */

/* Marker options block
//Set marker options
    //var markerOptions = {
        //radius: 10,
        //fillColor: "#faf357",
        //color: "#ecd12c",
        //weight: 1,
        //opacity: 1,
        //fillOpacity: 0.8
    //};
    */

/* Old Map info
L.tileLayer('https://api.mapbox.com/styles/v1/kachamb27/cjg4xuu5j1ckl2rqktungdnuh.html?fresh=true&title=true&access_token=pk.eyJ1Ijoia2FjaGFtYjI3IiwiYSI6ImNqNmpibGQ4MDExa3kzMm81cm40Nno2MmcifQ.P2vpP3jBxEef_K51_3nRHg#4.5/38.835970/-94.666164/0')
    //L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
    //attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
    maxZoom: 5,
    //id: 'mapbox.streets',
    //accessToken: 'pk.eyJ1Ijoia2FjaGFtYjI3IiwiYSI6ImNqNmpibGQ4MDExa3kzMm81cm40Nno2MmcifQ.P2vpP3jBxEef_K51_3nRHg'
    //})
        //.addTo(mymap);
*/

/* Trial map styles
// add base tilelayer from http://leaflet-extras.github.io/leaflet-providers/preview/
    // See CartoDB.DarkMatterNoLabels
    //L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_nolabels/{z}/{x}/{y}.png', {
	//attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',
	//subdomains: 'abcd',
	//maxZoom: 19
    //}).addTo(mymap);
    // add base tilelayer from http://leaflet-extras.github.io/leaflet-providers/preview/
    // See Stamen.TerrainBackground
    //L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/terrain-background/{z}/{x}/{y}.{ext}', {
	//attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
	//subdomains: 'abcd',
	//minZoom: 0,
	//maxZoom: 18,
	//ext: 'png'
    //}).addTo(mymap);
    */

/* Unused code from bottom of main.js

$('.menu-ui a').on('click', function() {
    // For each filter link, get the 'data-filter' attribute value.
    var filter = $(this).data('filter');
    $(this).addClass('active').siblings().removeClass('active');
    createPropSymbols.setFilter(function(f) {
        // If the data-filter attribute is set to "all", return
        // all (true). Otherwise, filter on markers that have
        // a value set to true based on the filter name.
        return (filter === 'all') ? true : f.properties[filter] === true;
    });
    return false;
    });
    

// Function to retrieve the data and place on map.
function getData(mymap){
    console.log("in getData, before ajax");
    var mydata;
    var markerOptions = {
        radius: 10,
        fillColor: "#faf357",
        color: "#000",
        weight: 1,
        opacity: 1,
        fillOpacity: 0.8
    };
    //load the data
    $.ajax("data/map2.geojson", {
        dataType: "json",
        success: function (response) {
            console.log(response);
            mydata = response;
            //call function to create proportional symbols
            //createPropSymbols(mydata)}
            //create a leaflet geojson layer and add to map.
            L.geoJson(mydata, {
                pointToLayer: function (feature, latlng) {
                    return L.circleMarker(latlng, markerOptions);
                }}).addTo(mymap);
        }});
    console.log("in getData, after ajax");
};

L.geoJson(mydata, {
                //onEachFeature: onEachFeature
                onEachFeature: onEachFeature}).addTo(mymap);

L.geoJson(mydata, {
                //onEachFeature: onEachFeature
                filter: function(feature, layer) {
                    return feature.properties.yr2017>200;
                }
                }).addTo(mymap);

//create an L.markerClusterGroup layer
            var markers = L.markerClusterGroup();
            
            //loop through features to create markers and add to markerClusterGroup
            for (var i=0; i<mydata.features.length; i++) {
                var a = mydata.features[i];
                //add properties html string to each marker
                var properties = "";
                for (var property in a.properties){
                    properties += "<p>" + property + ": " + a.properties[property]+"</p>";
                };
                var marker = L.marker(new L.LatLng(a.geometry.coordinates[1], a.geometry.coordinates[0]), { properties: properties});
                //add a popup for each marker
                marker.bindPopup(properties);
                //add marker to markerClusterGroup
                markers.addLayer(marker);
            }
            //add markerClusterGroup to map
            map.addlayer(markers);
        }
    });
};

var markerOptions = {
        radius: 10,
        fillColor: "#faf357",
        color: "#000",
        weight: 1,
        opacity: 1,
        fillOpacity: 0.8
    };
    
    
//build popup content string
    var popupContent = "<p><b>State:</b> " + feature.properties.StateName + "</p><p><b>" + "</p>";
    
    //add formatted attribute to popup content string
    var year = attribute.split("r")[1];
    popupContent += "<p>Avg. Yield in " + year+ ":</b> " + feature.properties[attribute] +" bu/ac</p>";
    
    //bind popup to circle marker
    layer.bindPopup(popupContent);
    
//To make tool tip, hover popups, Ex2.4 from lab inst 1-2
//Works with raster images but not vector/points like this lab.
var layer = L.marker(latlng, {
title:feature.properties.StateName
});

//build popup content string
    var popupContent = "<p><b>State:</b> " + feature.properties.StateName + "</p><p><b>" + "</p>";


$('.range-slider').on('input', function(){
        var index = $(this).val();


//add state to popup content string
            //var popupContent = "<p><b>State:</b> " + props.StateName + "</p>";
            
            //add formatted attribute to panel content string
            //var year = attribute.split("r")[1];
            //popupContent += "<p><b>Avg. Yield in " + year+ ":</b> " + props[attribute] +" bu/ac</p>";
            
            //replace the layer popup
            //layer.bindPopup(popupContent, {
            //    offset: new L.Point(0, -radius)
            //});

*/


/*
//function to retrieve the data and place it on the map
function getData(mymap){
    //load the data
    $.ajax("data/corn.geojson", {
        dataType: "json",
        success: function(response){

            //create a Leaflet GeoJSON layer and add it to the map
            L.geoJson(response, {
                onEachFeature: onEachFeature
            }).addTo(map);
        }
    });
};

$(document).ready(getData);
*/

//function to retrieve the data and place it on the map
function getData(map){
    //load the data
    $.ajax("data/corn.geojson", {
        dataType: "geojson",
        success: function(response){

            //create a Leaflet GeoJSON layer and add it to the map
            L.geoJson(response).addTo(map);
        }
    });
};

$(document).ready(createMap);

//load the data
$.ajax("data/corn.geojson", {
    dataType: "geojson",
    success: function(response){
        //create marker options
        var geojsonMarkerOptions = {
            radius: 8,
            fillColor: "#ff7800",
            color: "#000",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
        };

        //create a Leaflet GeoJSON layer and add it to the map
        L.geoJson(response, {
            pointToLayer: function (feature, latlng){
                return L.circleMarker(latlng, geojsonMarkerOptions);
            }
        }).addTo(map);
    }
});


//function to attach popups to each mapped feature
function onEachFeature(feature, layer) {
    //no property named popupContent; instead, create html string with all properties
    var popupContent = "";
    if (feature.properties) {
        //loop to add feature property names and values to html string
        for (var property in feature.properties){
            popupContent += "<p>" + property + ": " + feature.properties[property] + "</p>";
        }
        layer.bindPopup(popupContent);
    };
};


//function to retrieve the data and place it on the map
function getData(map){
    //load the data
    $.ajax("data/corn.geojson", {
        dataType: "json",
        success: function(response){

            //create a Leaflet GeoJSON layer and add it to the map
            L.geoJson(response, {
                onEachFeature: onEachFeature
            }).addTo(map);
        }
    });
};

//Example 2.3 line 22...load the data
    $.ajax("data/corn.geojson", {
        dataType: "json",
        success: function(response){

            //create a Leaflet GeoJSON layer and add it to the map
            L.geoJson(response, {
                //use filter function to only show cities with 2015 populations greater than 20 million
                filter: function(feature, layer) {
                    return feature.properties.Pop_2015 > 20;
                }
            }).addTo(map);
        }
    });

//function to retrieve the data and place it on the map
function getData(map){
    //load the data
    $.ajax("data/corn.geojson", {
        dataType: "json",
        success: function(response){
            //examine the data in the console to figure out how to construct the loop
            console.log(response)

            //create an L.markerClusterGroup layer
            var markers = L.markerClusterGroup();

            //loop through features to create markers and add to MarkerClusterGroup
            for (var i = 0; i < response.features.length; i++) {
                var a = response.features[i];
                //add properties html string to each marker
                var properties = "";
                for (var property in a.properties){
                    properties += "<p>" + property + ": " + a.properties[property] + "</p>";
                };
                var marker = L.marker(new L.LatLng(a.geometry.coordinates[1], a.geometry.coordinates[0]), { properties: properties });
                //add a popup for each marker
                marker.bindPopup(properties);
                //add marker to MarkerClusterGroup
                markers.addLayer(marker);
            }

            //add MarkerClusterGroup to map
            map.addLayer(markers);
        }
    });
};

//Example 2.7 line 1...function to retrieve the data and place it on the map
function getData(map){
    //load the data
    $.ajax("data/corn.geojson", {
        dataType: "json",
        success: function(response){
            //create a Leaflet GeoJSON layer
            var geoJsonLayer = L.geoJson(response);
            //create a L.markerClusterGroup layer
            var markers = L.markerClusterGroup();
            //add geojson to marker cluster layer
            markers.addLayer(geoJsonLayer);
            //add marker cluster layer to map
            map.addLayer(markers);
        }
    });
};



//Notes from main.js

/*
function jsAjax(){
    // Step 1: Create the request 
    var ajaxRequest = new XMLHttpRequest();

    //Step 2: Create an event handler to send received data to a callback function
    ajaxRequest.onreadystatechange = function(){
        if (ajaxRequest.readyState === 4){
            callback(ajaxRequest.response);
        };
    };

    //Step 3: Open the server connection
    ajaxRequest.open('GET', 'data/corn.geojson', true);

    //Step 4: Set the response data type
    ajaxRequest.responseType = "json";

    //Step 5: Send the request
    ajaxRequest.send();
};

//define callback function
function callback(response){
    //tasks using the data go here
    console.log(JSON.stringify(response));};

window.onload = jsAjax();

//define AJAX function
function jQueryAjax(){
    //basic jQuery ajax method
    $.ajax("data/corn.geojson", {
        dataType: "json",
        success: callback
    });
};

//define callback function
function callback(response, status, jqXHRobject){
    //tasks using the data go here
    console.log(response);
};

$(document).ready(jQueryAjax);

//function to retrieve the data and place it on the map
function getData(mymap){
    //load the data
    $.ajax("data/corn.geojson", {
        dataType: "json",
        success: function(response){

            //create a Leaflet GeoJSON layer and add it to the map
            L.geoJson(response, {
                onEachFeature: onEachFeature
            }).addTo(mymap);
        }
    });
};


//an AJAX function
function jQueryAjax(){
    var mydata = $.ajax("data/corn.geojson", {
        dataType: "json"
    });
    return mydata;
};

var mydata = jQueryAjax();

console.log(mydata); //the jQuery XMLHttpRequest object



//L.geojson()
var marker = L.marker([39.000, -97.000]).addTo(mymap);

var circle = L.circle([39.000, -97.000], {
    color: 'red',
    fillColor: '#f03',
    fillOpacity: 0.5,
    radius: 500
}).addTo(mymap);

var polygon = L.polygon([
    [38.000, -97.000],
    [39.000, -98.000],
    [39.000, -97.000]
]).addTo(mymap);

marker.bindPopup("<b>Hello world!</b><br>I am a popup.").openPopup();
circle.bindPopup("I am a circle.");
polygon.bindPopup("I am a polygon.");

var popup = L.popup()
    .setLatLng([51.5, -0.09])
    .setContent("I am a standalone popup.")
    .openOn(mymap);
function onMapClick(e) {
    alert("You clicked the map at " + e.latlng);
}

mymap.on('click', onMapClick);

var popup = L.popup();

function onMapClick(e) {
    popup
        .setLatLng(e.latlng)
        .setContent("You clicked the map at " + e.latlng.toString())
        .openOn(mymap);
}

mymap.on('click', onMapClick);
            
*/

/* Below content used in pre-jquery code development. From main.js

//Adding markers to features.
var geojsonMarkerOptions = {
    radius: 10,
    fillColor: "#faf357",
    weight: 0,
    opacity: 1,
    fillOpacity: 0.8
};

//Adjust radius of each feature to to yield value.
// Currently doesn't work...
function onEachFeature(feature, layer) {
    if (feature.properties && feature.properties.yr2017) {
       var geojsonMarkerOptions = {
           radius: yr2017}
       }
    }

//Adding markers to geojson features.
L.geoJSON(geojsonFeature, {pointToLayer: function (feature, latlng) {
    return L.circleMarker(latlng, geojsonMarkerOptions);
}}).addTo(mymap);  

L.geoJSON(geojsonFeature, {pointToLayer: function (feature, latlng) {
        return L.circleMarker(latlng, geojsonMarkerOptions);}})

//Couldn't get this to work in main.js
$.ajax("data/Corn.geojson", {
        dataType: "json",
        success: function(response){
            console.log("in response function")
            //create a leaflet geojson layer and add to map
            L.geoJson(response).addTo(mymap);}
    })
    
    
//Working block for getting data.
// Function to retrieve the data and place on map.
function getData(mymap){
    //load the data
    //Adding markers to geojson features.
    L.geoJSON(geojsonFeature, {pointToLayer: function (feature, latlng) {
        return L.circleMarker(latlng, geojsonMarkerOptions);
        onEachFeature
    }}).addTo(mymap);
};